<!DOCTYPE html>
	<html>
	<head>
		<title>Jeremy's Comics</title>
		<style type="text/css">
			body {
				width: 1000px;
				margin: auto;
				background-color: #4c565e;
				color: #FFFFFF;
			}
		</style>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	</head>
	<body>
		<!-- load jquery locally and the local cross-domain access hack -->
		<script type="text/javascript" src="jquery-2.1.3.min.js"></script>
		<script type="text/javascript" src="jquery.xdomainajax.js"></script>
		<script type="text/javascript">
		// sites are ordered on the page based on how they're ordered here.
		var sites = new Array();
		sites.push({
			name : 'Dilbert',
			url : 'http://dilbert.com',
			getter : function(div, responseText){
				var path = $('div[class=img-comic-container]:first > a > img', responseText).attr('src');
				$(div).html('Dilbert:<br /><img src="'+path+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Foxtrot',
			all : function(div){
				$.ajax({
					url: 'https://api.import.io/store/data/b741d878-720d-4d65-8f32-41a4a005d0bf/_query?' +
						'input/webpage/url=http%3A%2F%2Fwww.foxtrot.com%2F&_user=02485b91-0592-4f2a-969f-510ce20ea130' +
						'&_apikey=RI%2B%2BPKmYVI%2FFG1BvjDCBdzjrdonkcvPY2f%2FfEH5%2BtwwwuhPIwsmWtqjEjs87%2BKFs4ooOn9QC1kV8aD0VI1QblQ%3D%3D',
					dataType: 'json',
					type: 'get',
					success: function(response){
							var src = response.results[0].attachment_image_thumb_image.replace('-318x149', '');
							$(div).html('Foxtrot:<br /><img src="'+src+'"/><br /><br />');
						}
					});
			}
		});
		sites.push({
			name : 'xkcd',
			all : function(div) {
				$.ajax({
					url : "https://www.kimonolabs.com/api/2900c7ms?apikey=AiTQypB6vHJm3VemAWkwk9wmsaQmpDMo",
					dataType : "jsonp",
					success : function(data) {
						var comic = data.results.page[0].comic;
						$(div).html('xkcd:<br />'+comic.alt+'<br /><img src="'+comic.src+'"/><br />'+comic.title+'<br /><br />');
					}
				});
			}
		});
		sites.push({
			name : 'Frazz',
			url : 'http://www.gocomics.com/frazz/?ref=comics',
			getter : function(div, responseText){
				var image = $('img[class=strip]:first', responseText).attr('src');
				$(div).html('Frazz:<br /><img src="'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Megatokyo',
			url : 'http://www.megatokyo.com/',
			getter : function(div, responseText){
				var relative = $('#strip img', responseText).attr('src');
				$(div).html('Megatokyo:<br /><img src="http://www.megatokyo.com/'+relative+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Penny Arcade',
			all : function(div) {
				$.ajax({
					url : "https://www.kimonolabs.com/api/ay3okncy?apikey=AiTQypB6vHJm3VemAWkwk9wmsaQmpDMo",
					dataType : "jsonp",
					success : function(data) {
						var comic = data.results.page[0].comic;
						$(div).html('Penny Arcade:<br />'+comic.alt+'<br /><img src="'+comic.src+'"/><br /><br />');
					}
				});
			}
		});
		sites.push({
			name : 'Least I Could Do',
			all : function(div){ 
				$.get('http://leasticoulddo.com/', function(data){ 
					var url = $('#feature-comic', data.responseText).attr('href');
					$.get(url, function(data){
						$(div).html('Least I Could Do:<br /><img src="'+$('#comic-img > img', data.responseText).attr('src')+'"/><br /><br />');
					});
				});
			}
		});
		sites.push({
			name : 'PHD Comics',
			url : 'http://www.phdcomics.com/comics.php',
			getter : function(div, responseText){
				var image;
				$('img', responseText).each(function(){
					if ($(this).attr('src').indexOf('archive/phd') != -1){
						image = $(this).attr('src');
					}
				});
				$(div).html('PHD Comics:<br /><img src="'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'VG Cats',
			url : 'http://www.vgcats.com/comics/',
			getter : function(div, responseText){
				var image;
				$('img', responseText).each(function(){
					if ($(this).attr('src').indexOf('images') == 0){
						image = $(this).attr('src');
					}
				});
				$(div).html('VG Cats:<br /><img src="http://www.vgcats.com/comics/'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Super Effective',
			url : 'http://www.vgcats.com/super/',
			getter : function(div, responseText){
				var image;
				$('img', responseText).each(function(){
					if ($(this).attr('src').indexOf('images') == 0){
						image = $(this).attr('src');
					}
				});
				$(div).html('Super Effective:<br /><img src="http://www.vgcats.com/super/'+image+'"/><br /><br />');
			}
		});

		function write_failure(div, site, textStatus, errorThrown){
			$('#errors').append("<li>Error requesting " + site.name + ": " + textStatus + ", " + errorThrown + "</li>");
			$(div).html('');
		}
	
		// create an anonymous temporary function to call getter() with the appropriate arguments
		function compose_success(div, site){
			return function(data, textStatus, jqXHR){
				site.getter(div, data.responseText);
			};
		}

		function compose_failure(div, site){
			return function(jqXHR, textStatus, errorThrown){
				write_failure(div, site, textStatus, errorThrown);
			};
		}
		
		$(document).ready(function(){
			// for every site, spawn off an asynchronous request to download the page
			// and process it
			for (var i in sites){
				var site = sites[i];
				$("#comics").append("<div id=\"comic"+i+"\">Fetching "+site.name+"</div>");
				if (typeof site.url !== "undefined"){
					var request = $.ajax({
						url: site.url,
						type: 'GET',
						success: compose_success('#comic'+i, site),
						error: compose_failure('#comic'+i, site)
					});
					site.request = request;
				}else{
					site.all('#comic'+i);
				}
			}
		});
		</script>
		<div><ul id="errors" /></div>
		<div id="title"><strong>Comics:</strong><br></div>
		<div id="comics" />
	</body>
	</html>
