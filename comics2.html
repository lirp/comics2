<!DOCTYPE html>
	<html>
	<head>
		<title>Jeremy's Comics</title>
		<style type="text/css">
			body {
				width: 1000px;
				margin: auto;
				background-color: #4c565e;
				color: #FFFFFF;
			}
		</style>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	</head>
	<body>
		<script type="text/javascript" src="jquery-3.2.1.min.js"></script>
		<script type="text/javascript">
		var saved;
		function get_proxy(site, chain) {
			$.getJSON('https://whateverorigin.herokuapp.com/get?url=' + encodeURIComponent(site) + '&callback=?', chain);
		}
		// sites are ordered on the page based on how they're ordered here.
		var sites = new Array();
		sites.push({
			name : 'Dilbert',
			url : 'http://dilbert.com',
			getter : function(div, responseText){
				var path = $('div[class=img-comic-container]:first > a > img', responseText).attr('src');
				$(div).html('Dilbert:<br /><img src="'+path+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Foxtrot',
			url : 'http://www.foxtrot.com',
			getter : function(div, responseText){
				var src = $('img', responseText)[2]['src'].replace('-318x149', '');
				$(div).html('Foxtrot:<br /><img src="'+src+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'xkcd',
			url : 'http://xkcd.com',
			getter : function(div, responseText){
				var img = $('div#comic img', responseText)[0];
				var src = 'https://' + img['src'].replace(/.*\/\//, '');
				var alt = img['alt'];
				var title = img['title'];
				$(div).html('xkcd:<br />' + alt + '<br /><img src="'+src+'"/><br />' + title + '<br /><br />');
			}
		});
		sites.push({
			name : 'Frazz',
			url : 'http://www.gocomics.com/frazz/',
			getter : function(div, responseText){
				var image = $('.item-comic-image:first > img', responseText).attr('src');
				$(div).html('Frazz:<br /><img src="'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Megatokyo',
			url : 'http://www.megatokyo.com/',
			getter : function(div, responseText){
				var relative = $('#strip img', responseText).attr('src');
				$(div).html('Megatokyo:<br /><img src="http://www.megatokyo.com/'+relative+'"/><br /><br />');
			}
		});
//		sites.push({
//			name : 'Penny Arcade',
//			all : function(div) {
//				$.ajax({
//					url : "https://www.kimonolabs.com/api/ay3okncy?apikey=AiTQypB6vHJm3VemAWkwk9wmsaQmpDMo",
//					dataType : "jsonp",
//					success : function(data) {
//						var comic = data.results.page[0].comic;
//						$(div).html('Penny Arcade:<br />'+comic.alt+'<br /><img src="'+comic.src+'"/><br /><br />');
//					}
//				});
//			}
//		});
		sites.push({
			name : 'Camp Comic',
			url : 'http://campcomic.com/comic/',
			getter : function(div, responseText){
				var src = $('div#comic img', responseText)[0]['src'];
				$(div).html('Camp Comic:<br /><img src="'+src+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Least I Could Do',
			all : function(div){ 
				get_proxy('http://leasticoulddo.com/', function(data){ 
					var url = $('#feature-comic', data.contents).attr('href');
					get_proxy(url, function(data){
						$(div).html('Least I Could Do:<br /><img src="'+$('#comic-img > img', data.contents).attr('src')+'"/><br /><br />');
					});
				});
			}
		});
		sites.push({
			name : 'PHD Comics',
			url : 'http://phdcomics.com',
			getter : function(div, responseText){
				var pos1 = responseText.indexOf('archive/phd');
				var pos2 = responseText.indexOf('.gif', pos1);
				var image = 'http://phdcomics.com/comics/' + responseText.substr(pos1, pos2 - pos1) + '.gif';
				$(div).html('PHD Comics:<br /><img src="'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'VG Cats',
			url : 'http://www.vgcats.com/comics/',
			getter : function(div, responseText){
				var image;
				$('img', responseText).each(function(){
					if ($(this).attr('src').indexOf('images') == 0){
						image = $(this).attr('src');
					}
				});
				$(div).html('VG Cats:<br /><img src="http://www.vgcats.com/comics/'+image+'"/><br /><br />');
			}
		});
		sites.push({
			name : 'Super Effective',
			url : 'http://www.vgcats.com/super/',
			getter : function(div, responseText){
				var image;
				$('img', responseText).each(function(){
					if ($(this).attr('src').indexOf('images') == 0){
						image = $(this).attr('src');
					}
				});
				$(div).html('Super Effective:<br /><img src="http://www.vgcats.com/super/'+image+'"/><br /><br />');
			}
		});

		// create an anonymous temporary function to call getter() with the appropriate arguments
		function compose_success(div, site){
			return function(data){
				site.getter(div, data.contents);
			};
		}
		
		$(document).ready(function(){
			// for every site, spawn off an asynchronous request to download the page
			// and process it
			for (var i in sites){
				var site = sites[i];
				$("#comics").append("<div id=\"comic"+i+"\">Fetching "+site.name+"</div>");
				if (typeof site.url !== "undefined"){
					get_proxy(site.url, compose_success('#comic'+i, site));
				}else{
					site.all('#comic'+i);
				}
			}
		});
		</script>
		<div><ul id="errors" /></div>
		<div id="title"><strong>Comics:</strong><br></div>
		<div id="comics" />
	</body>
	</html>
